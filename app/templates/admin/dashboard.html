{% extends "base.html" %}
{% from "partials/components.html" import page_header, stat_pill %}
{% block title %}Admin Dashboard{% endblock %}

{% block content %}
{% call page_header("Administration", "Operational Dashboard", "Monitor registrations, proxy approvals, and live
distribution activity across FoodLink Society.") %}
<a class="btn btn-outline-primary btn-sm" href="{{ url_for('admin.verify_clients') }}">Verify Clients</a>
{% endcall %}

<div class="stat-grid mb-4">
    {{ stat_pill("Total Clients", stats.total_clients) }}
    {{ stat_pill("Pending Clients", stats.pending_clients, "warning") }}
    {{ stat_pill("Verified Clients", stats.verified_clients, "success") }}
    {{ stat_pill("Volunteers", stats.total_volunteers) }}
    {{ stat_pill("Pending Proxies", stats.pending_proxies, "warning") }}
    {{ stat_pill("Today's Distributions", stats.todays_distributions, "info") }}
    {{ stat_pill("Active Sign-ins", stats.active_signins, "info") }}
    {{ stat_pill("No-Show Alerts", stats.no_show_alerts, "danger") }}
</div>

<div class="row g-4">
    <!-- Pending Registrations -->
    <div class="col-lg-4">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title mb-0">Pending Registrations</h5>
                    <a class="btn btn-link btn-sm" href="{{ url_for('admin.verify_clients') }}">View all</a>
                </div>
                {% if pending_clients %}
                <ul class="list-group list-group-flush">
                    {% for c in pending_clients %}
                    <li class="list-group-item">
                        <div class="fw-semibold">{{ c.full_name }}</div>
                        <div class="small text-muted mb-2">{{ c.email }}</div>
                        <a class="btn btn-sm btn-outline-primary"
                            href="{{ url_for('admin.client_profile', client_id=c.client_id) }}">Review Profile</a>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted mb-0">No pending registrations.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Pending Volunteers -->
    <div class="col-lg-4">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title mb-0">Pending Volunteers</h5>
                    <a class="btn btn-link btn-sm" href="{{ url_for('admin.verify_volunteers') }}">View all</a>
                </div>
                <div class="text-center py-3">
                    <h2 class="display-4 fw-bold text-warning">{{ stats.pending_volunteers }}</h2>
                    <p class="text-muted small">Awaiting Approval</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Pending Proxies -->
    <div class="col-lg-4">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title mb-0">Pending Proxies</h5>
                    <a class="btn btn-link btn-sm" href="{{ url_for('admin.proxy_requests') }}">View all</a>
                </div>
                {% if pending_proxies %}
                <ul class="list-group list-group-flush">
                    {% for p in pending_proxies %}
                    <li class="list-group-item">
                        <div class="fw-semibold">{{ p.proxy_name }}</div>
                        <div class="small text-muted">{{ p.client_number }} ({{ p.client_name }})</div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted mb-0">No pending proxy requests.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Recent Distributions -->
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-body">
                <h5 class="card-title mb-3">Recent Distributions</h5>
                {% if recent_distributions %}
                <ul class="list-neutral">
                    {% for d in recent_distributions %}
                    <li>
                        <div class="fw-semibold">{{ d.client_number }}</div>
                        <div class="small text-muted">
                            {{ d.distribution_date.strftime("%b %d, %Y %H:%M") }} &mdash; {{ d.volunteer_name }}
                        </div>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted mb-0">No distributions recorded yet.</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- High Risk Clients -->
    <div class="col-lg-6">
        <div class="card h-100">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <h5 class="card-title mb-0">High Risk Clients</h5>
                    <a class="btn btn-link btn-sm" href="{{ url_for('admin.no_show_report') }}">Full report</a>
                </div>
                {% if top_no_shows %}
                <ul class="list-group list-group-flush">
                    {% for item in top_no_shows %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <div>
                            <div class="fw-semibold">{{ item.full_name }}</div>
                            <div class="small text-muted">{{ item.client_number }}</div>
                        </div>
                        <span class="badge-soft badge-soft-danger">{{ item.no_show_count }} no-shows</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted mb-0">No clients flagged.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}