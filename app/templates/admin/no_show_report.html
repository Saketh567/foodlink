{% extends "base.html" %}
{% block title %}No-Show Report{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center flex-wrap gap-2 mb-4">
    <div>
        <p class="text-uppercase text-muted small mb-1">Operations</p>
        <h1 class="mb-0">No-Show Report</h1>
    </div>
    <a class="btn btn-outline-secondary btn-sm" href="{{ url_for('admin.dashboard') }}">Back to Dashboard</a>
</div>

<div class="row g-3 mb-4">
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-body text-center">
                <p class="text-muted mb-1">Today</p>
                <h3 class="mb-0">{{ stats.today }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-body text-center">
                <p class="text-muted mb-1">Last 7 Days</p>
                <h3 class="mb-0">{{ stats.week }}</h3>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card shadow-sm h-100">
            <div class="card-body text-center">
                <p class="text-muted mb-1">All Time</p>
                <h3 class="mb-0">{{ stats.total }}</h3>
            </div>
        </div>
    </div>
</div>

<div class="row g-4">
    <div class="col-lg-4">
        <div class="card shadow-sm">
            <div class="card-body">
                <div class="d-flex justify-content-between align-items-center mb-2">
                    <h5 class="card-title mb-0">High-Risk Clients</h5>
                    <span class="badge bg-warning text-dark">Threshold {{ threshold }}</span>
                </div>
                {% if high_risk %}
                    <ul class="list-group list-group-flush">
                        {% for client in high_risk %}
                        <li class="list-group-item d-flex justify-content-between align-items-center">
                            <div>
                                <div class="fw-semibold">{{ client.full_name }}</div>
                                <div class="text-muted small">{{ client.client_number }}</div>
                            </div>
                            <span class="badge bg-danger">{{ client.no_show_count }}</span>
                        </li>
                        {% endfor %}
                    </ul>
                {% else %}
                    <p class="text-muted mb-0">No clients beyond the threshold.</p>
                {% endif %}
            </div>
        </div>
    </div>
    <div class="col-lg-8">
        <div class="card shadow-sm h-100">
            <div class="card-body">
                <h5 class="card-title mb-3">Recent No-Show Logs</h5>
                {% if logs %}
                <div class="table-responsive">
                    <table class="table table-sm align-middle">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Client</th>
                                <th>Logged By</th>
                                <th>Reason</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for log in logs %}
                            <tr>
                                <td>{{ log.created_at.strftime("%b %d, %Y %H:%M") }}</td>
                                <td>{{ log.client_name }} ({{ log.client_number }})</td>
                                <td>{{ log.volunteer_name or 'N/A' }}</td>
                                <td>{{ log.reason or 'N/A' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
                {% else %}
                    <p class="text-muted mb-0">No no-show records available.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}
